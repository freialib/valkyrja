var Rsync = require('rsync');
var _ = {
	each: require('lodash.foreach')
};
var is = {
	bool: require('lodash.isboolean'),
	string: require('lodash.isstring')
};

module.exports = function (conf) {
	var rsync = new Rsync();

	rsync.shell('ssh');

	if (conf.rsync) {
		var flags = {};
		var opts = {};
		_.each(conf.rsync, function (value, key) {
			if (is.bool(value)) {
				flags[key] = value;
			}
			else if (is.string(value)) {
				rsync.set(key, value);
			}
		});
		rsync.flags(flags);
	}

	if (conf.rsync.exclude) {
		rsync.exclude(conf.rsync.exclude);
	}

	if (conf.rsync.include) {
		rsync.include(conf.rsync.include);
	}

	if (conf.rsync.patterns) {
		rsync.patterns(conf.rsync.patterns);
	}

	return rsync;
}
