var fs = require('fs');
var c = require('chalk');
var Promise = require('lie');
// ----------------------------------------------------------------------------

var make_file = function (cwd, draftdir, draftfile) {
	return new Promise(function (resolve, reject) {
		process.stdout.write(c.gray('writing') + ' ' + draftfile);
		fs.createReadStream(draftdir + '/' + draftfile)
			.pipe(fs.createWriteStream(cwd + '/' + draftfile))
			.on('close', function () {
				console.log(' ' + c.gray('[') + c.blue('done') + c.gray(']'));
				resolve();
			});
	});
};

var make_mainconf = function (cwd, draftdir) {
	return make_file(cwd, draftdir, '.valkyrja.toml');
};

var make_userconf = function (cwd, draftdir) {
	return make_file(cwd, draftdir, '.valkyrja.user.toml');
};

var make_toolsconf = function (cwd, draftdir) {
	return make_file(cwd, draftdir, '.valkyrja.js');
};

module.exports = function (cwd, args, draftdir) {
	if (args.length == 0) {
		make_mainconf(cwd, draftdir);
	}
	else if (args[0] == 'user') {
		make_userconf(cwd, draftdir);
	}
	else if (args[0] == 'tools') {
		make_toolsconf(cwd, draftdir);
	}
	else if (args[0] == 'all') {
		make_userconf(cwd, draftdir)
			.then(function () {
				make_mainconf(cwd, draftdir)
					.then(function () {
						make_toolsconf(cwd, draftdir);
					})
			});
	}
	else { // unknown
		console.log(c.red('valkyrja') + ': no idea what you tried to do');
	}
}
