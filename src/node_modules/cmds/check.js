var Promise = require('lie');
var readtools = require('lib/readtools');
var readconf = require('lib/readconf');
var c = require('chalk');
// ----------------------------------------------------------------------------

module.exports = function (cwd, args, draftdir) {
	var conf = readconf(cwd, '.valkyrja');

	var type = 'all';
	if (args.length > 0) {
		type = args.shift();
	}

	var category = 'production';
	if (args.length > 0) {
		category = args.shift();
	}

	var tools = readtools(cwd, '.valkyrja');
	var checkstep = tools.check(cwd, args, conf, type, category, null);

	if (checkstep === true) {
		checkstep = Promise.resolve();
	}

	checkstep.then(function () {
		console.log('');
		console.log(c.blue('check succesful'))
		console.log('');
	}, function (reason) {
		if ( ! /exited with code/.test('' + reason)) {
			if (reason) {
				if (reason.stack) {
					console.log(reason.stack);
				}
				else { // non-stack error
					console.log(reason);
				}
			}

			console.log('');
		}

		console.log(c.red.dim('check failed'))
		console.log('');

		return Promise.reject();
	});
};
